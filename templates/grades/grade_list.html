{% extends "base.html" %}

{% block title %}Grades & Enrollments{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
        <h2 class="mb-0"><i class="bi bi-award me-2"></i>Grades & Enrollments</h2>
        <a href="{% url 'enrollment_create' %}" class="btn btn-primary"><i class="bi bi-plus-lg me-1"></i>Enroll Student</a>
    </div>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-12 col-md-4">
                    <label for="course" class="form-label visually-hidden">Course</label>
                    <select name="course" id="course" class="form-select">
                        <option value="">All Courses</option>
                        {% for c in courses %}
                        <option value="{{ c.pk }}" {% if selected_course == c.pk|stringformat:"s" %}selected{% endif %}>{{ c.name }} ({{ c.code }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-12 col-md-4">
                    <label for="student" class="form-label visually-hidden">Student</label>
                    <select name="student" id="student" class="form-select">
                        <option value="">All Students</option>
                        {% for s in students %}
                        <option value="{{ s.pk }}" {% if selected_student == s.pk|stringformat:"s" %}selected{% endif %}>{{ s.full_name }} ({{ s.roll_number }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-12 col-md-4">
                    <button type="submit" class="btn btn-outline-primary me-2"><i class="bi bi-funnel me-1"></i>Filter</button>
                    <a href="{% url 'grade_list' %}" class="btn btn-outline-secondary">Clear</a>
                </div>
            </form>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-body">
            {% if enrollments %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Course</th>
                            <th>Grade</th>
                            <th>Marks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for enr in enrollments %}
                        <tr>
                            <td>
                                <a href="{% url 'student_detail' enr.student.pk %}">{{ enr.student.full_name }}</a>
                                <small class="text-muted d-block">{{ enr.student.roll_number }}</small>
                            </td>
                            <td>{{ enr.course.name }} ({{ enr.course.code }})</td>
                            <td>{% if enr.grade %}{{ enr.grade.grade_value|default:"—" }}{% else %}—{% endif %}</td>
                            <td>{% if enr.grade %}{{ enr.grade.marks|default:"—" }}{% else %}—{% endif %}</td>
                            <td>
                                <a href="{% url 'grade_edit' enr.pk %}" class="btn btn-sm btn-outline-primary">{% if enr.grade and enr.grade.grade_value %}Update{% else %}Assign{% endif %}</a>
                                <a href="{% url 'grade_report' enr.student.pk %}" class="btn btn-sm btn-outline-info">Report</a>
                                <a href="{% url 'enrollment_delete' enr.pk %}" class="btn btn-sm btn-outline-danger">Remove</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted mb-0">No enrollments found. <a href="{% url 'enrollment_create' %}">Enroll a student</a>.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
